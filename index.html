<html>
<head>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <style>
    .std { width: 150px; height: 150px; padding: 0.5em; }
    /*
    .draggable { width: 150px; height: 150px; padding: 0.5em; }
    */
    .page { background-image: url('grid120.png') }
    </style>
    <script>
    var ctx, obj
    $(function() {
        ctx = {}
        ctx.preset = {
          nextCreationPosition: {
            left: 120,
            top: 120
          },
          creationPositionIncrements: {
            left: 10,
            top: 10
          },
          controls: {
            panel: {
              width: 120,
              height: 120
            }
          }
        }
        ctx.default = $.extend(true, {}, ctx.preset)
        ctx.utils = {}
        ctx.utils.creationPosition = function () {
          var p = $.extend({}, this)
          this.left += ctx.default.creationPositionIncrements.left
          this.top += ctx.default.creationPositionIncrements.top
          return p;
        }
        ctx.utils.uiposition = function () {
          return "left+" + this.left + " top+" + this.top;
        }

        ctx.$page = $(".page")
        ctx.manager = {}
        ctx.nextCreationPosition = $.extend({}, ctx.default.nextCreationPosition)
        ctx.controls = {}
        var m = ctx.manager
        console.log(ctx.$page.position());
        m.createPanel = function () {
          var control = $.extend(true, {}, ctx.default.controls["panel"])
          control.position = ctx.utils.creationPosition.apply(ctx.nextCreationPosition)
          console.log(control);

          var elm = $("<div class='ui-widget-content std draggable resizable'>aaa</div>")
          .appendTo(ctx.$page)
          .draggable()
          .position({ my: "left top", at: ctx.utils.uiposition.apply(control.position), of: ctx.$page})
          .uniqueId()
          .height(control.height).width(control.width)

          control.elm = elm
          ctx.controls[elm.attr("id")] = control

          console.log(ctx.controls);
        }

        $( ".draggable" ).draggable();
        $( ".resizable" ).resizable();
        $( "#text" ).draggable();

        $("#pannelButton").click(function (e) {
          m.createPanel()
        })
    });
    </script>
</head>
<body style="">
  <div class="page">
    <div class="ui-widget-content std draggable resizable">
        <button>Input Text</button>
        <button id="pannelButton">Pannel</button>
        <button id="headerButton">Header</button>
        <button>Footer</button>
        <button>Left Sidebar</button>
        <button>Right Sidebar</button>
    </div>
    <div class="ui-widget-content std draggable resizable">
        <p>Drag me around</p>
    </div>
    <div id="text" style="padding: 8">
    <input type="text" size="20" />
    </div>
  </div>
</body>
</html>
